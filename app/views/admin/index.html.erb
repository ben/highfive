<div class="row">
  <h1 class="col-md-9">Statistics for <%= current_team.team_name %></h1>
  <%= render 'tangocard_prompt' %>
</div>

<!-- TODO: message if authed for admin but app not configured -->

<% unless slack_users_info %>
<div class="alert alert-warning">
  Couldn't connect to Slack for user data, so we'll only be showing a reduced data set for now.
  Try again in a few minutes.
</div>
<% end %>

<p class="pull-right">
  Download:
    <%= link_to 'CSV', admin_index_path(format: :csv) %> |
    <%= link_to 'XLSX', admin_index_path(format: :xlsx) %>
</p>
<% if @tango_account %>
<p>
  Current Tangocard account balance: <strong><%= @tango_account['currentBalance'].to_s(:currency) %></strong>
</p>
<% end %>

<div class="clear-right table-responsive">
  <table class="table table-striped">
    <thead>
      <th>Date</th>
      <th>From</th>
      <th>To</th>
      <th>Reason</th>
      <th>Amount</th>
      <th>Card code</th>
    </thead>
    <tbody>
      <% @records.each do |record| %>
        <tr>
          <td>
            <time datetime="<%= record.created_at.to_datetime %>">
              <span class="timestring"><%= record.created_at %></span>
            </time>
          </td>
          <td>
            <%= link_to "slack://user?team=#{current_team.team_id}&id=#{record.from}" do %>
              <%= record.from_name %>
            <% end %>
          </td>
          <td>
            <%= link_to "slack://user?team=#{current_team.team_id}&id=#{record.to}" do %>
              <%= record.to_name %>
            <% end %>
          </td>
          <td>
            <span title="<%= record.reason %>"><%= record.reason.truncate(50, separator: ' ') %></span>
          </td>
          <td><%= record.amount&.to_s(:currency) || '—' %></td>
          <td><%= record.card_code ? '<em>REDACTED</em>'.html_safe : '—' %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= will_paginate @records %>
</div>
